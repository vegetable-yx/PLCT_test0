+ source common/common_pcp-system-tools.sh
++ source /root/mugen-riscv/libs/locallibs/common_lib.sh
+++ python3 --version
+++ '[' 0 -eq 0 ']'
+++ source /root/mugen-riscv/libs/locallibs/common_lib_python.sh
+ main
++ type -t post_test
+ '[' -n function ']'
+ trap post_test EXIT INT HUP TERM
+ rpm -qa
+ grep expect
++ type -t config_params
+ '[' -n '' ']'
++ type -t pre_test
+ '[' -n function ']'
+ pre_test
+ LOG_INFO 'Start to prepare the test environment.'
+ message='Start to prepare the test environment.'
+ python3 /root/mugen-riscv/libs/locallibs/mugen_log.py --level info --message 'Start to prepare the test environment.'
Fri Feb  3 03:41:31 2023 - INFO  - Start to prepare the test environment.
+ deploy_env
+ DNF_INSTALL 'pcp pcp-system-tools'
+ pkgs='pcp pcp-system-tools'
+ node=1
+ '[' -z '' ']'
+ tmpfile=
++ python3 /root/mugen-riscv/libs/locallibs/rpm_manage.py install --pkgs 'pcp pcp-system-tools' --node 1 --tempfile ''
+ tmpfile2=/tmp/tmppnpezrxq
+ '[' -z '' ']'
+ tmpfile=/tmp/tmppnpezrxq
+ systemctl enable pmcd
+ systemctl start pmcd
+ systemctl enable pmlogger
+ systemctl start pmlogger
+ SLEEP_WAIT 20
+ wait_time=20
+ cmd=
+ mode=1
+ python3 /root/mugen-riscv/libs/locallibs/sleep_wait.py --time 20 --cmd '' --mode 1
++ hostname
+ host_name=openEuler-riscv64
++ rpm -qa pcp
++ awk -F - '{print $2}'
+ pcp_version=5.3.5
++ awk -F: '{print $NF}'
++ pcp -h openEuler-riscv64
++ grep 'primary logger:'
+ archive_data=' /var/log/pcp/pmlogger/openEuler-riscv64/20230203.03.42'
++ lsblk
++ grep disk
++ awk '{print $1}'
+ disk_name=vda
+ OLD_PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
+ export PATH=/usr/libexec/pcp/bin/:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
+ PATH=/usr/libexec/pcp/bin/:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
+ LOG_INFO 'End to prepare the test environment.'
+ message='End to prepare the test environment.'
+ python3 /root/mugen-riscv/libs/locallibs/mugen_log.py --level info --message 'End to prepare the test environment.'
Fri Feb  3 03:44:02 2023 - INFO  - End to prepare the test environment.
++ type -t run_test
+ '[' -n function ']'
+ run_test
+ LOG_INFO 'Start to run test.'
+ message='Start to run test.'
+ python3 /root/mugen-riscv/libs/locallibs/mugen_log.py --level info --message 'Start to run test.'
Fri Feb  3 03:44:02 2023 - INFO  - Start to run test.
+ SLEEP_WAIT 60
+ wait_time=60
+ cmd=
+ mode=1
+ python3 /root/mugen-riscv/libs/locallibs/sleep_wait.py --time 60 --cmd '' --mode 1
+ pcp-iostat --version
+ grep 5.3.5
pcp-iostat version 5.3.5
+ CHECK_RESULT 0
+ actual_result=0
+ expect_result=0
+ mode=0
+ error_log=
+ '[' -z 0 ']'
+ '[' 0 -eq 0 ']'
+ test 0x '!=' 0x
+ return 0
+ pcp-iostat -a /var/log/pcp/pmlogger/openEuler-riscv64/20230203.03.42 -A 10min -s 10
+ grep rrqm/s
# Device      rrqm/s  wrqm/s     r/s    w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await   %util
+ CHECK_RESULT 0
+ actual_result=0
+ expect_result=0
+ mode=0
+ error_log=
+ '[' -z 0 ']'
+ '[' 0 -eq 0 ']'
+ test 0x '!=' 0x
+ return 0
+ pcp-iostat -a /var/log/pcp/pmlogger/openEuler-riscv64/20230203.03.42 -G sum -s 10
+ grep 'sum(.*)'
sum(.*)         0.00  120.00    0.00  14.00     0.00  1977.00  141.214    0.092    6.57    0.00    6.57    5.10
sum(.*)         0.00  121.00    0.00  15.00     0.00  1976.00  131.733    0.091    6.07    0.00    6.07    5.20
sum(.*)         0.00  120.00    0.00  14.00     0.00  1976.00  141.143    0.091    6.50    0.00    6.50    5.10
sum(.*)         0.00  121.00    0.00  14.00     0.00  1976.00  141.143    0.092    6.57    0.00    6.57    5.20
sum(.*)         0.00  120.00    0.00  15.00     0.00  1977.00  131.800    0.091    6.07    0.00    6.07    5.10
sum(.*)         0.00  120.00    0.00  14.00     0.00  1976.00  141.143    0.092    6.57    0.00    6.57    5.10
sum(.*)         0.00  121.00    0.00  15.00     0.00  1976.00  131.733    0.091    6.07    0.00    6.07    5.20
sum(.*)         0.00  120.00    0.00  14.00     0.00  1977.00  141.214    0.091    6.50    0.00    6.50    5.10
+ CHECK_RESULT 0
+ actual_result=0
+ expect_result=0
+ mode=0
+ error_log=
+ '[' -z 0 ']'
+ '[' 0 -eq 0 ']'
+ test 0x '!=' 0x
+ return 0
+ pcp-iostat -h openEuler-riscv64 -s 10
+ grep wrqm/s
# Device      rrqm/s  wrqm/s     r/s    w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await   %util
+ CHECK_RESULT 0
+ actual_result=0
+ expect_result=0
+ mode=0
+ error_log=
+ '[' -z 0 ']'
+ '[' 0 -eq 0 ']'
+ test 0x '!=' 0x
+ return 0
+ pcp-iostat -a /var/log/pcp/pmlogger/openEuler-riscv64/20230203.03.42 -O @08 -s 10 -t 2
+ grep r/s
+ CHECK_RESULT 1
+ actual_result=1
+ expect_result=0
+ mode=0
+ error_log=
+ '[' -z 1 ']'
+ '[' 0 -eq 0 ']'
+ test 1x '!=' 0x
+ test -n ''
+ (( exec_result++ ))
+ LOG_ERROR 'oe_test_pcp-iostat.sh line 43'
+ message='oe_test_pcp-iostat.sh line 43'
+ python3 /root/mugen-riscv/libs/locallibs/mugen_log.py --level error --message 'oe_test_pcp-iostat.sh line 43'
Fri Feb  3 03:45:21 2023 - ERROR - oe_test_pcp-iostat.sh line 43
+ return 0
+ grep w/s
+ pcp-iostat -a /var/log/pcp/pmlogger/openEuler-riscv64/20230203.03.42 -P 1 -s 10
# Device     rrqm/s wrqm/s    r/s   w/s   rkB/s   wkB/s avgrq-sz avgqu-sz  await r_await w_await  %util
+ CHECK_RESULT 0
+ actual_result=0
+ expect_result=0
+ mode=0
+ error_log=
+ '[' -z 0 ']'
+ '[' 0 -eq 0 ']'
+ test 0x '!=' 0x
+ return 0
+ pcp-iostat -a /var/log/pcp/pmlogger/openEuler-riscv64/20230203.03.42 -R vda -s 10
+ grep vda
vda             0.00  120.00    0.00  14.00     0.00  1977.00  141.214    0.092    6.57    0.00    6.57    5.10
vda             0.00  121.00    0.00  15.00     0.00  1976.00  131.733    0.091    6.07    0.00    6.07    5.20
vda             0.00  120.00    0.00  14.00     0.00  1976.00  141.143    0.091    6.50    0.00    6.50    5.10
vda             0.00  121.00    0.00  14.00     0.00  1976.00  141.143    0.092    6.57    0.00    6.57    5.20
vda             0.00  120.00    0.00  15.00     0.00  1977.00  131.800    0.091    6.07    0.00    6.07    5.10
vda             0.00  120.00    0.00  14.00     0.00  1976.00  141.143    0.092    6.57    0.00    6.57    5.10
vda             0.00  121.00    0.00  15.00     0.00  1976.00  131.733    0.091    6.07    0.00    6.07    5.20
vda             0.00  120.00    0.00  14.00     0.00  1977.00  141.214    0.091    6.50    0.00    6.50    5.10
+ CHECK_RESULT 0
+ actual_result=0
+ expect_result=0
+ mode=0
+ error_log=
+ '[' -z 0 ']'
+ '[' 0 -eq 0 ']'
+ test 0x '!=' 0x
+ return 0
+ pcp-iostat -a /var/log/pcp/pmlogger/openEuler-riscv64/20230203.03.42 -S @00 -T @23 -s 10
+ grep rkB/s
# Device      rrqm/s  wrqm/s     r/s    w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await   %util
+ CHECK_RESULT 0
+ actual_result=0
+ expect_result=0
+ mode=0
+ error_log=
+ '[' -z 0 ']'
+ '[' 0 -eq 0 ']'
+ test 0x '!=' 0x
+ return 0
+ pcp-iostat -a /var/log/pcp/pmlogger/openEuler-riscv64/20230203.03.42 -u -s 10
+ grep wkB/s
# Device      rrqm/s  wrqm/s     r/s    w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await   %util
+ CHECK_RESULT 0
+ actual_result=0
+ expect_result=0
+ mode=0
+ error_log=
+ '[' -z 0 ']'
+ '[' 0 -eq 0 ']'
+ test 0x '!=' 0x
+ return 0
+ pcp-iostat -Z Africa/Lagos -s 10
+ grep Device
# Device      rrqm/s  wrqm/s     r/s    w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await   %util
+ CHECK_RESULT 0
+ actual_result=0
+ expect_result=0
+ mode=0
+ error_log=
+ '[' -z 0 ']'
+ '[' 0 -eq 0 ']'
+ test 0x '!=' 0x
+ return 0
+ pcp-iostat -a /var/log/pcp/pmlogger/openEuler-riscv64/20230203.03.42 -z -s 10
+ grep avgrq-sz
# Device      rrqm/s  wrqm/s     r/s    w/s    rkB/s    wkB/s avgrq-sz avgqu-sz   await r_await w_await   %util
+ CHECK_RESULT 0
+ actual_result=0
+ expect_result=0
+ mode=0
+ error_log=
+ '[' -z 0 ']'
+ '[' 0 -eq 0 ']'
+ test 0x '!=' 0x
+ return 0
+ pcp-iostat -a /var/log/pcp/pmlogger/openEuler-riscv64/20230203.03.42 -x dm -s 5
+ grep avgqu-sz
pcp-iostat: Instance domain identifier not defined in the PCP archive log
+ CHECK_RESULT 1
+ actual_result=1
+ expect_result=0
+ mode=0
+ error_log=
+ '[' -z 1 ']'
+ '[' 0 -eq 0 ']'
+ test 1x '!=' 0x
+ test -n ''
+ (( exec_result++ ))
+ LOG_ERROR 'oe_test_pcp-iostat.sh line 57'
+ message='oe_test_pcp-iostat.sh line 57'
+ python3 /root/mugen-riscv/libs/locallibs/mugen_log.py --level error --message 'oe_test_pcp-iostat.sh line 57'
Fri Feb  3 03:45:42 2023 - ERROR - oe_test_pcp-iostat.sh line 57
+ return 0
+ LOG_INFO 'End to run test.'
+ message='End to run test.'
+ python3 /root/mugen-riscv/libs/locallibs/mugen_log.py --level info --message 'End to run test.'
Fri Feb  3 03:45:43 2023 - INFO  - End to run test.
+ CASE_RESULT 0
+ case_re=0
+ test -z 2
+ test 2 -gt 0
+ LOG_ERROR 'failed to execute the case.'
+ message='failed to execute the case.'
+ python3 /root/mugen-riscv/libs/locallibs/mugen_log.py --level error --message 'failed to execute the case.'
Fri Feb  3 03:45:43 2023 - ERROR - failed to execute the case.
+ exit 2
+ post_test
+ LOG_INFO 'Start to restore the test environment.'
+ message='Start to restore the test environment.'
+ python3 /root/mugen-riscv/libs/locallibs/mugen_log.py --level info --message 'Start to restore the test environment.'
Fri Feb  3 03:45:44 2023 - INFO  - Start to restore the test environment.
+ clear_env
+ systemctl stop pmcd
+ systemctl stop pmlogger
+ DNF_REMOVE
+ node=1
+ pkg_list=
+ mode=0
+ [[ -z /tmp/tmppnpezrxq ]]
+ '[' 0 -ne 0 ']'
+ '[' 1 == 0 ']'
+ python3 /root/mugen-riscv/libs/locallibs/rpm_manage.py remove --node 1 --pkgs '' --tempfile /tmp/tmppnpezrxq
+ '[' 0 -ne 0 ']'
+ PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
+ LOG_INFO 'End to restore the test environment.'
+ message='End to restore the test environment.'
+ python3 /root/mugen-riscv/libs/locallibs/mugen_log.py --level info --message 'End to restore the test environment.'
Fri Feb  3 03:46:53 2023 - INFO  - End to restore the test environment.
